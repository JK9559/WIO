## ```Chapter One``` 网络通信原理
----
### ```C/S``` 信息传输流程：
>完成一次网络通信，经过5个步骤：
> 1. ```Client``` 产生数据 --> 存在 ```Client``` 应用的*内存* --> 调接口将数据发送或者拷贝到```OS```内存中。
> 2. ```Client``` 的 ```OS``` 收到数据后，按照 ```Client``` 指定的*协议*，调*网卡*发送数据。
> 3. 网络传输数据。
> 4. ```Server``` 调 ```OS``` 接口，*想要*将数据从系统内存拷贝到自己的内存中。
> 5. ```Server``` 的 ```OS``` 收到指令后，使用与 ```Client``` 相同的协议从网卡读取数据，然后拷贝给服务端应用。
### ```TCP/IP``` 五层模型
* #### 物理层
    >用来发送高低电平信息，可以理解为一串01串。
    >
    >常见设备：中继器、集线器、双绞线。

* #### 数据链路层
    >实际应用中，会将电平信号分组处理，多少位一组，每组什么意思，通过这个来获取数据的实际含义。
    >
    >数据链路层就是定义电平信号的分组方式。
    >
    >使用了基于 ```MAC``` 地址的*广播方式*的*以太网协议*实现数据传输。(只能在局域网内广播)
    >
    >*以太网协议*
    > 1. 由一组电平信号构成的数据包，称为“*帧*”，每个数据帧由报头 ```Head``` 和 ```Data``` 组成。 ```Head``` 固定 18 字节，目的 ```MAC``` 地址 6 字节，源 ```MAC``` 地址 6 字节，数据类型 6 字节。 ```Data``` 最短 46 字节，最长 1500 字节。如果 ```Data``` 超过1500字节，则分片发送。
    > 2. ```MAC``` 地址：世界唯一，6 字节
    > 3. 广播：以一对多的通信方式。对于*以太网协议*当其他网卡拿到的目标 ```MAC``` 地址不是自己的 ```MAC``` 地址的话，会直接丢弃报文。

* #### 网络层
    >前提：以太网包只能在在局域网内传递，一个局域网是一个广播域，跨广播域通信只能通过路由转发。区分不同的广播域就是通过*网络层*的网络地址实现的。
    >
    > ```IP``` 地址：点分十进制，由两部分组成，网络地址 + 主机地址。通过子网掩码可以得到网络地址和主机地址
    >
    > ```IP``` 数据报：分为两部分， ```Head``` 部分和 ```Data``` 部分， ```Head``` 部分 20-60 字节。 ```Data``` 部分最长 65515 字节。 ```IP``` 数据报直接塞在以太网数据报的 ```Data``` 部分。
    >
    > ```ARP``` 协议：知道了目标地址的 ```IP``` 地址，需要知道目标地址的 ```MAC``` 时，通过此协议获取。
    >
    > 描述一次通信：```A``` 主机和 ```B``` 主机是跨广播域的。需要通过*路由即网关*连接。这时 ```A``` 还未知 ```B``` 的 ```MAC``` 地址。这时 ```A``` 是通过将目标 ```MAC``` 地址替换为 ```A``` 主机的网关的 ```MAC``` 地址。然后网关再获取 ```B``` 的 ```MAC``` 地址，这时，网关将报文的源 ```MAC``` 地址替换为自己的 ```MAC``` 地址，目标 ```MAC``` 地址为 ```B``` 的 ```MAC``` 地址。源和目标的 ```IP``` 地址始终不变。进行通信。注意，这其中主机 ```A``` 网关 主机 ```B``` 之间可能互相不知道对方的 ```MAC``` 地址，这里用 ```ARP``` 广播查找，单播回复机制，缓存对方的 ```MAC``` 地址。

* #### 传输层
    > 有了各种主机地址，但是不同的应用程序使用的是不同的端口，使用端口区分不同的应用。
    >
    > 端口范围 0-65535。其中 0-1023 系统保留、 1024-49152 用户可注册、 49152-65535 随机端口取值。
    >
    > 为什么是 65535 ？因为 ```TCP``` 给端口 16 ```bits``` 也就是 2 字节，最大 65535。
    >  
    > 三次握手过程
    >
    > 四次挥手过程

* #### 应用层
    > 常用应用层协议：
    > ```DNS``` 、 ```HTTP``` 、 ```FTP``` 、 ```SMTP``` 、 ```POP3``` 、 ```Telnet```。

### 网络通信实现原理
> 实现网络通信，需要四个要素：本机 ```IP```、子网掩码、网关 ```IP```、 ```DNS``` 的 ```IP```。
>
> 如何获取四要素？可以手动配置也可以通过 ```DHCP``` （动态主机配置协议）自动获取。
> 
> ```DHCP``` 实现过程如下
> 
> 报文数据结构为：以太网头部 + ```IP``` 头部 + ```UDP``` 头部 + ```DHCP``` 数据包
>
> * 以太网头部：为本机 ```MAC``` + 全 ```F``` 的广播地址
> * ```IP``` 头部：发送方为 0.0.0.0 接收方为 255.255.255.255
> * ```UDP``` 头部：发送方端口 68 接收方端口 67
> 
> 构造完成后，只有 ```DHCP``` 服务器知道这个请求，会进行处理，处理完毕后发回去一个响应包。
> 
> 响应包结构类似，以太网头部 ```MAC``` 地址为双方 ```MAC``` 地址， ```IP``` 头部为 ```DHCP``` 服务器 ```IP```地址（发送方） 255.255.255.255 （接收方）， ```UDP``` 头部端口 67 为发送方 68 为接收方。分配给主机的具体参数在 ```Data``` 域里。
>
>至此，主机拿到了通信必须的四要素。
### 向浏览器输入 ```URL``` 之后发生了什么
